!pb  26.10.06: close file after read or write
!pb  31.10.06:  definition of RPART, RPARTC, IPART, IPARTC changed
!               RPART(NPARTT,NPRNL) --> RPART(NPRNL,NPARTT)
C
C
      SUBROUTINE WRSNAP
C
C  SAVE SNAPSHOT POPULATION AT END OF TIMESTEP
C
      USE PRECISION
      USE PARMMOD
      USE CTRCEI
      USE COMPRT
      USE COMNNL
      USE COMSOU

      IMPLICIT NONE

      INTEGER :: I, J
C
      OPEN (UNIT=15,ACCESS='SEQUENTIAL',FORM='UNFORMATTED')
      REWIND 15
C
      IF (TRCFLE) WRITE (iunout,*) 'WRITE 15: IPRNL,FLUX,DTIMV '
      WRITE (15) IPRNL,FLUX(NSTRAI),DTIMV
      WRITE (15) ((RPARTC(J,I),J=1,NPARTT),I=1,IPRNL)
      WRITE (15)  (RPARTW(I)              ,I=0,IPRNL)
      WRITE (15) ((IPARTC(J,I),J=1,MPARTT),I=1,IPRNL)
      CLOSE (UNIT=15)
C
      RETURN
C
      ENTRY RSNAP
C
      OPEN (UNIT=15,ACCESS='SEQUENTIAL',FORM='UNFORMATTED')
      REWIND 15
      READ (15) IPRNL,FLUX(NSTRAI),DTIMV
      IF (TRCFLE) WRITE (iunout,*) 'READ 15: IPRNL,FLUX,DTIMV '
      READ (15) ((RPARTC(J,I),J=1,NPARTT),I=1,IPRNL)
      READ (15)  (RPARTW(I)              ,I=0,IPRNL)
      READ (15) ((IPARTC(J,I),J=1,MPARTT),I=1,IPRNL)
      CLOSE (UNIT=15)
C
      RETURN
      END
