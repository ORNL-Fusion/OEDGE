!pb  18.12.06: definition of RPARTC changed
C
      SUBROUTINE MKCENS

      USE PRECISION
      USE PARMMOD
      USE COMUSR
      USE CINIT
      USE COMPRT
      USE COMNNL
      USE COMSOU
      USE CTEXT

      IMPLICIT NONE

      REAL(DP) :: DTIMVO
      INTEGER :: I, IFIRST, IERROR

      SAVE
      DATA IFIRST/0/
C
C  SET DEFAULTS FOR SOURCE DUE TO INITIAL CONDITION, VALID ONLY FOR
C  FIRST TIMESTEP. MODIFIED FOR LATER TIMESTEPS IN SUBR. TMSTEP
C
C  DEFINE ONE MORE STRATUM
      IF (IFIRST.EQ.0) THEN
        IFIRST=1
        NSTRAI=NSTRAI+1
C  CHECK STORAGE
        IF (NSTRAI.GT.NSTRA) THEN
          CALL MASPRM('NSTRA',5,NSTRA,'NSTRAI',6,NSTRAI,IERROR)
          CALL EXIT_OWN(1)
        ENDIF
C
        TXTSOU(NSTRAI)='SOURCE DUE TO INITIAL CONDITION          '
C  SOURCE DISTRIBUTION SAMPLED FROM CENSUS ARRAYS RPARTC,IPARTC
        NLCNS(NSTRAI)=.TRUE.
        NLPNT(NSTRAI)=.FALSE.
        NLLNE(NSTRAI)=.FALSE.
        NLSRF(NSTRAI)=.FALSE.
        NLVOL(NSTRAI)=.FALSE.
C  DO NOT CALL IF2COP(NSTRAI)
        INDSRC(NSTRAI)=-1
C
        NLAVRP(NSTRAI)=.FALSE.
        NLAVRT(NSTRAI)=.FALSE.
        NLSYMP(NSTRAI)=.FALSE.
        NLSYMT(NSTRAI)=.FALSE.
        NPTS(NSTRAI)=0
        NINITL(NSTRAI)=2000*NINITL(NSTRAI-1)+1
        NEMODS(NSTRAI)=1
        NAMODS(NSTRAI)=1
        FLUX(NSTRAI)=0.
        NLATM(NSTRAI)=.FALSE.
        NLMOL(NSTRAI)=.FALSE.
        NLION(NSTRAI)=.FALSE.
        NLPLS(NSTRAI)=.FALSE.
        NSPEZ(NSTRAI)=0
        NSRFSI(NSTRAI)=0
C
        SORENI(NSTRAI)=0.
        SORENE(NSTRAI)=0.
        SORVDX(NSTRAI)=0.
        SORVDY(NSTRAI)=0.
        SORVDZ(NSTRAI)=0.
        SORCOS(NSTRAI)=0.
        SORMAX(NSTRAI)=0.
        SORCTX(NSTRAI)=0.
        SORCTY(NSTRAI)=0.
        SORCTZ(NSTRAI)=0.
C
      ENDIF
C
C  READ INITIAL POPULATION FROM PREVIOUS RUN, OVERWRITE DEFAULTS
C
      IF (NFILEJ.EQ.2.OR.NFILEJ.EQ.3) THEN

C  NEW TIMESTEP
        IF (DTIMVN.LE.0.D0) THEN
          DTIMVN=DTIMV
C       ELSE
C         DTIMVN=DTIMVN
        ENDIF
C
C  READ CENSUS ARRAY FROM OLD TIMESTEP
        CALL RSNAP
        DTIMVO=DTIMV
C
        WRITE (iunout,*) 'INITIAL POPULATION FOR FIRST TIMESTEP'
        WRITE (iunout,*) 'READ FROM FILE FT 15 '
        WRITE (iunout,*) 'PARTICLES AND FLUX STORED FOR INITIAL '
        WRITE (iunout,*) 'DISTRIBUTION IN PREVIOUS RUN '
        CALL MASJ1('IPRNL   ',IPRNL)
        CALL MASR1('FLUX    ',FLUX(NSTRAI))
C
        IF (DTIMVN.NE.DTIMVO) THEN
          FLUX(NSTRAI)=FLUX(NSTRAI)*DTIMVO/DTIMVN
C
          WRITE (iunout,*) 'FLUX IS RESCALED BY DTIMV_OLD/DTIMV_NEW '
          CALL MASR1('FLUX    ',FLUX(NSTRAI))
          CALL LEER(1)
        ENDIF
C
        DTIMV=DTIMVN
C
        IF (NPTST.LE.0) THEN
          NPTS(NSTRAI)=IPRNL
        ELSEIF (NPTST.GT.0) THEN
          NPTS(NSTRAI)=NPTST
        ENDIF
C
        IF (NPTS(NSTRAI).GT.0.AND.FLUX(NSTRAI).GT.0) THEN
          NSRFSI(NSTRAI)=1
          SORWGT(1,NSTRAI)=1.D0
        ENDIF
C
        CALL LEER(2)
        DO I=1,IPRNL
          RPARTC(10,I)=TIME0
        ENDDO
        WRITE (iunout,*) 'PARTICLE CLOCK RESET TO TIME0'
        WRITE (iunout,*) 'FIRST TIMESTEP RUNS FROM TIM1 TO TIM2:  '
          CALL MASR2('TIM1, TIM2      ',TIME0,TIME0+DTIMV)
          CALL LEER(2)
C
      ENDIF
      RETURN
      END
