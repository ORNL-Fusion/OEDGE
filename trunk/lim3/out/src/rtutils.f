      SUBROUTINE RTXY ( VS,NR,NT,IFOLD,ISTATE,MAXSTATE)
C
      IMPLICIT none
C 
      INCLUDE 'params'
C
      INCLUDE 'rtheta'
C      
      INCLUDE 'comxyt'
C
      INTEGER  ISTATE, MAXSTATE,NR,NT,IFOLD
      REAL     VS(MAXNXS,-MAXNYS:MAXNYS,-1:MAXIZS)        
      INTEGER  IPOS 
      EXTERNAL IPOS
C
C     *****************************************************************
C
C     THIS SUBROUTINE COPIES THE VALUES IN THE X,Y MESH ARRAY GIVEN
C     BY VS TO THE R,THETA ARRAY RTMESH. THE QUANTITIES TRANSFERRED
C     ARE DENSITIES AND MUST LATER BE MODIFIED BY BIN SIZES IN ORDER 
C     TO ALLOW INTEGRATIONS TO PROCEED CORRECTLY. THE QUANTITIES ARE 
C     FOR A SPECIFIC LINE OR IONIZATION STATE UNLESS A VALUE GREATER
C     THAN THE MAXIMUM ALLOWED IS SPECIFIED. IN THIS CASE THE CODE 
C     SUMS OVER THE IONIZATION STATES REQUESTED.
C
C     D. ELDER   JUNE 19 , 1990
C
C     *****************************************************************
C
      REAL XTMP,YTMP
      INTEGER IX,IY,IR,IZ,IT,IZ1,IZ2
C
C     LEAVE OUT ZEROING OF RTMESH SINCE ALL THE ELEMENTS WHICH NEED TO BE 
C     ACCESSED ARE OVERWRITTEN. IF THIS IS A PROBLEM LATER A CALL TO
C     RZERO FOR RTMESH CAN EASILY BE ADDED.
C     E.G.
C     CALL RZERO(RTMESH,MAXNRS*MAXNAS)
C
      IF (ISTATE.GT.MAXSTATE) THEN 
        IZ1 = 1
        IZ2 = MAXSTATE
      ELSE
        IZ1 = ISTATE
        IZ2 = ISTATE
      ENDIF 

      DO 180 IZ = IZ1,IZ2
        DO 180 IR = 1,NR
          DO 180 IT = 1,NT
            IF (IFOLD.EQ.1) THEN 
              RTMESH(IR,IT) = 0.5 * 
     >             (VS(RTXCOORD(IR),RTYCOORD(IT),IZ) + 
     >              VS(RTXCOORD(IR),-RTYCOORD(IT),IZ)) 
            ELSE
              RTMESH(IR,IT) = VS(RTXCOORD(IR),RTYCOORD(IT),IZ) 
            ENDIF
 180  CONTINUE
      RETURN
      END
C
C
      SUBROUTINE RTORD (RINTS,VMIN)
C
      IMPLICIT none
C
      INCLUDE 'params'
C
      INCLUDE 'rtheta'
C
      REAL RINTS(MAXNAS,-2:MAXIZS+1),VMIN
C
C     THIS SUBROUTINE SIMPLY REARRANGES THE COORDINATES AND THE
C     VALUES TO BE PLOTTED IF A NEGATIVE ANGLE WAS SPECIFIED FOR 
C     PLOTTING THE ANGULAR DEPENDENCE.
C
C     DAVID ELDER , JUNE 26, 1990 
C
      REAL TMPOUTS(MAXNAS),TMPWIDS(MAXNAS)
      REAL TMPINTS(MAXNAS,-2:MAXIZS+1)
      INTEGER IN,IN1,IZ,IPOS
      EXTERNAL IPOS
C
C     CALCULATE INDEX OF NEGATIVE START POINT 
C
      IN1 = IPOS(2*PI+VMIN,TS,MAXNAS-1)
      WRITE(6,*) 'RTORD: IN1: ' ,IN1
C
C     MOVE COORDINATES AND VALUES FROM THIS POINT TO END OF THE 
C     ARRAY (2PI) TO THE BEGINNING. ADJUST THE COORDINATES TO 
C     NEGATIVE ANGLE VALUES. 
C
      DO 100 IN= IN1,NAS
        TMPOUTS(IN-IN1+1) = TOUTS(IN)-2*PI
        TMPWIDS(IN-IN1+1) = TWIDS(IN)        
        DO 100 IZ = -2,MAXIZS+1
          TMPINTS(IN-IN1+1,IZ) = RINTS(IN,IZ)     
100   CONTINUE  
C
C     MOVE FIRST PART INTO THE LATTER SECTION OF THE ARRAY
C
      DO 200 IN = IN1-1,1,-1
        TMPOUTS(NAS-IN+1) = TOUTS(IN1-IN)
        TMPWIDS(NAS-IN+1) = TWIDS(IN1-IN)
        DO 200 IZ = -2,MAXIZS+1
          TMPINTS(NAS-IN+1,IZ) = RINTS(IN1-IN,IZ)
200   CONTINUE
C
C     COPY BACK INTO THE ORIGINAL ARRAYS
C
      DO 300 IN = 1,NAS
        TOUTS(IN) = TMPOUTS(IN)
        TWIDS(IN) = TMPWIDS(IN) 
        DO 300 IZ = -2,MAXIZS+1
          RINTS(IN,IZ) = TMPINTS(IN,IZ)
          WRITE(6,*) 'RTORD: IN,IZ,TMPOUTS,TMPINTS',IN,IZ,
     >         TMPOUTS(IN), TMPINTS(IN,IZ)
300   CONTINUE                             
      RETURN
      END    
C
C
C
      SUBROUTINE CVRTDEG ( VALS , NS,VMIN,VMAX)
C
      INTEGER NS,I
      REAL VALS(NS),VMIN,VMAX
      REAL RADDEG
      DATA RADDEG /57.29578122/
C
C     THIS ROUTINE CONVERTS THE CONTENTS OF THE GIVEN ARRAY FROM
C     RADIANS TO DEGREES 
C
      DO 10 I = 1,NS
         VALS(I) = VALS(I) * RADDEG
10    CONTINUE
      VMIN = VMIN *RADDEG
      VMAX = VMAX * RADDEG   
      RETURN
      END
