module mod_io_units
  use error_handling

  implicit none
  !
  !     datunit initialization is done at the beginning of the rundiv
  !     module - datunit is in a common block at the moment becasue its
  !     value needs to change for a kludgy work around on reordering
  !     some printed data.
  !
  !     the following is a list of most of the unit numbers referred to
  !     by divimp and eirene - i am trying to centralize this data to
  !     make it easier to select unit numbers when adding output to the code.
  !     much of this information can also be found by looking through the
  !     rundiv and runeire scripts.
  !
  ! unit#  purpose/file name
  !
  !    4   equilibrium grid file
  !    5   standard input  - usually the case file name (.d6i)
  !    6   standard output - usually mapped to debug output (.lim)
  !    7   case print out file (.dat)
  !    8   divimp raw data file (.raw)
  !    9   divimp/out input echo file (.inp)
  !   11   fluid code plasma solution to be read in (if one is specified) ($3$4,$3$4.g80,&
  !     $3.g80))
  !   12   auxiliary data file accompanying the background plasma solution ($3$4.aux,&
  !     $3.aux)
  !   13   experimental data file associated with this shot/grid ($3$4.experimemt,$3.experiment)
  !   14   nimbus - link to fort.5 supplies nimbus namelist input
  !   15   nimbus output file (.pinout)
  !   16   eirene/nimbus file for data transfer to divimp (.pinraw)
  !   17   pin file from divimp supplying plasma background to eirene/nimbus (.pin)
  !   18   ninbus - reserved for pump input files (set in nimbin namelist)
  !   20   eirene99 - link to equilibrium grid file - unit #4
  !  *21   eirene99 - link to trim.dat    ***    divimp - additional sol22 output (.sol22)
  !   22   divimp - html version of the data file (.html)
  !   24   divimp - print-out of pin data (eirene99 or nimbus) (.pinprn)
  !   26   out - column formatted print out of specified xy type plots (.grp)
  !   27   out - signal formatted file for plot outputs
  !   28   divimp/nimbus - jet hybrid wall data - link to shots/hydrid.dat
  !   30   nimbus - nimbus archive file - this is presently turned off
  !   31   eirene99 - link to divimp plasma input - unit #17
  !   32   eirene99 - eirene output file (.eir)
  !   35   nimbus - nimbus input file passed from linkpg (.pinmc)
  !   36   nimbus - nimbus punch file passed back to linkpg
  !   37   nimbus - nimbus print file - scanned by divimp for some data (.pinnim)
  !   41   tran file - data for the jet post processor routines
  !   46   diag - file containing divimp diagnostic and debug information
  !   49   out - additional plot output information - including result for single point data (.plt)
  !  *50   eirene99 - eirene input file    ***   divimp - debugging output file (contents?) (.debug)
  !   52   divimp/eirene99 - eirene geometry file (.eirgeo) - sometimes linked to upgrade.geom
  !   56   out - text print out of reciprocating probe data for specific plots (.probe)
  !   57   out - text print out of erosion/deposition data
  !   60   nimbus - reserved in nimbus for reading adas data
  !   62   divimp - divimp internal format background plasma if requested (.bgp)
  !   71   divimp - additional output from sol23 (.sol23)
  !   73   divimp - excel spreadsheet formatted data from sol23 (.exl23)
  !   74   divimp - link to cfd solution from previous divimp run (<oldcase>.cfd)
  !   75   divimp - cfd plasma solution from current sol23 run (.cfd)
  !   79   divimp - ??? - (.raw.rel)
  !   80   eirene99 - eirene particle tracks (.eirtrc)
  !   81   divimp - input file to eirene generated by divimp - linked to fort.50 by eirene99
  !   85   divimp - ??? - (.g1)
  !   87   divimp - ??? - (.g3)
  !   88   divimp - ??? - (.src)
  !   89   divimp - ??? - (.raw.src)
  !   94   divimp - ??? - (.raw.pla)
  !   95   divimp - ??? - (.raw.geo)
  !   99   eirene99 - temporary file used to add pressure guage data to fort.32
  !
  !
  !      data datunit /7/
  !
  
public

  integer,public :: htmlunit,pinunit,tmpunit,auxunit,exptunit,tranunit,diagunit
  parameter(exptunit= 13,pinunit = 19,htmlunit= 22, tmpunit = 23,tranunit= 41,diagunit= 46, auxunit = 61)
  integer,public :: ipindat,ipinout,inimout
  parameter(ipindat=15, ipinout=16, inimout=37)

  ! define standard units 
  integer,public :: stderr= 0, init_stderr= 0
  integer,public :: stdin = 5, init_stdin = 5
  integer,public :: stdout= 6, init_stdout= 6

  ! supply initial default values for unit numbers just in case
  integer,public :: stddbg = 6, init_stddbg = 6
  integer,public :: datunit= 7, init_datunit= 7
  integer,public :: stdraw = 8, init_stdraw = 8
  integer,public :: echout = 9, init_echout = 9

  integer,public :: s22out =21, init_s22out =21   ! SOL22 output

  integer,public :: outunito= 49,init_outunito = 49   ! for LIM-OUT plotting code ... change outunit to outunito to avoid conflicts with outunit in DIVIMP

  integer,private :: init_htmlunit, init_pinunit,init_tmpunit, init_auxunit, init_tranunit, init_diagunit

  logical,private :: first = .true.

  ! Move some SL output units to this file from slcom
  integer,public :: slout = 50
  integer,public :: erout = 50
  
  ! LIM I/O unit documentation - since this file is shared between LIM and DIVIMP
  !     Some of the logical units used by the LIM code  
  !
  !integer datunit,stddbg,outunit,exptunit
  !
  !parameter(stddbg =  6, datunit = 7, exptunit=13, outunit=49)
  ! Unit#  Purpose/File name
  !	    
  !    5   Standard input  - usually the case file name (.d6i)
  !    6   Standard output - usually mapped to debug output (.lim)
  !    7   Case print out file (.dat)
  !    8   LIM raw data file (.raw)
  !    9   LIM/OUT input echout file (.inp)             
  !   13   Experimental Data file associated with this shot/grid ($3$4.experimemt,$3.experiment)
  !   26   OUT .grp output file
  !   49   OUT .plt output file
  ! 

  
contains

  subroutine set_unit_numbers(in_stderr,in_stdin,in_stdout,in_stddbg,in_datunit,in_echout)
    implicit none
    integer,optional,intent(in) :: in_stderr,in_stddbg, in_datunit,in_echout, in_stdin, in_stdout

    if (first) then 
       if (present(in_stdin)) then 
          init_stdin = in_stdin
       endif
       if (present(in_stdout)) then 
          init_stdout = in_stdout
       endif
       if (present(in_stderr)) then 
          init_stderr = in_stderr
       endif
       if (present(in_stddbg)) then 
          init_stddbg = in_stddbg
       endif
       if (present(in_echout)) then 
          init_echout = in_echout
       endif
       if (present(in_datunit)) then 
          init_datunit = in_datunit
       endif
       first = .false.
    endif

    if (present(in_stdin)) then 
       stdin = in_stdin
    endif
    if (present(in_stdout)) then 
       stdout = in_stdout
    endif
    if (present(in_stderr)) then 
       stderr = in_stderr
    endif
    if (present(in_stddbg)) then 
       stddbg = in_stddbg
    endif
    if (present(in_echout)) then 
       echout = in_echout
    endif
    if (present(in_datunit)) then 
       datunit = in_datunit
    endif
    
  end subroutine set_unit_numbers

  subroutine reset_unit_numbers
    implicit none
    stdin   = init_stdin
    stdout  = init_stdout
    stderr  = init_stderr
    stddbg  = init_stddbg
    datunit = init_datunit
    echout  = init_echout
    
  end subroutine reset_unit_numbers
  

end module mod_io_units
