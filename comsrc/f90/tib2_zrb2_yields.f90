module tib2_zrb2_yields

implicit none
private

! This module uses Behrisch/Eckstein fits from trim.sp and experimental 
! data to provide rough estimates of the yielda from TiB2 and ZrB2 for 
! deuterium impact. Data provided by Lauren Nuckols. To estimate the
! yields, we are just doing the stoichiometric sputterring yields:
!
! For TiB2:  Y_B_TiB2  = (2/3) * Y_B
!            Y_Ti_TiB2 = (1/3) * Y_Ti
! For ZrB2:  Y_B_ZrB2  = (2/3) * Y_B
!            Y_Zr_ZrB2 = (1/3) * Y_Zr


! This dataset all have the same energies, no need to define for each 
! element.
integer, parameter :: n_values = 100
real :: d_impact_e(n_values)
data d_impact_e / &
       1.00000000e+00, 1.08984148e+00, 1.18775445e+00, 1.29446407e+00, &
       1.41076064e+00, 1.53750546e+00, 1.67563723e+00, 1.82617896e+00, &
       1.99024558e+00, 2.16905218e+00, 2.36392304e+00, 2.57630139e+00, &
       2.80776012e+00, 3.06001344e+00, 3.33492958e+00, 3.63454458e+00, &
       3.96107745e+00, 4.31694651e+00, 4.70478737e+00, 5.12747243e+00, &
       5.58813215e+00, 6.09017821e+00, 6.63732883e+00, 7.23363628e+00, &
       7.88351687e+00, 8.59178369e+00, 9.36368225e+00, 1.02049293e+01, &
       1.11217553e+01, 1.21209502e+01, 1.32099143e+01, 1.43967126e+01, &
       1.56901346e+01, 1.70997595e+01, 1.86360272e+01, 2.03103154e+01, &
       2.21350242e+01, 2.41236676e+01, 2.62909736e+01, 2.86529935e+01, &
       3.12272209e+01, 3.40327206e+01, 3.70902706e+01, 4.04225154e+01, &
       4.40541340e+01, 4.80120226e+01, 5.23254938e+01, 5.70264936e+01, &
       6.21498382e+01, 6.77334716e+01, 7.38187469e+01, 8.04507324e+01, &
       8.76785453e+01, 9.55557156e+01, 1.04140582e+02, 1.13496727e+02, &
       1.23693440e+02, 1.34806242e+02, 1.46917434e+02, 1.60116714e+02, &
       1.74501837e+02, 1.90179340e+02, 2.07265333e+02, 2.25886358e+02, &
       2.46180322e+02, 2.68297527e+02, 2.92401774e+02, 3.18671582e+02, &
       3.47301508e+02, 3.78503590e+02, 4.12508913e+02, 4.49569324e+02, &
       4.89959297e+02, 5.33977966e+02, 5.81951336e+02, 6.34234706e+02, &
       6.91215290e+02, 7.53315095e+02, 8.20994038e+02, 8.94753358e+02, &
       9.75139324e+02, 1.06274728e+03, 1.15822607e+03, 1.26228282e+03, &
       1.37568817e+03, 1.49928203e+03, 1.63397975e+03, 1.78077891e+03, &
       1.94076672e+03, 2.11512808e+03, 2.30515432e+03, 2.51225279e+03, &
       2.73795730e+03, 2.98393944e+03, 3.25202097e+03, 3.54418735e+03, &
       3.86260238e+03, 4.20962430e+03, 4.58782318e+03, 5.00000000e+03 /

! D-->Ti, physical. TrimSP calculated.
real :: d_ti_yields(n_values)
data d_ti_yields / &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 1.50868554e-05, &
       1.11325903e-04, 2.77213044e-04, 5.19634424e-04, 8.49356032e-04, &
       1.28023212e-03, 1.82371273e-03, 2.48906559e-03, 3.28137638e-03, &
       4.19916431e-03, 5.23390356e-03, 6.36930617e-03, 7.58216431e-03, &
       8.84436145e-03, 1.01252889e-02, 1.13948335e-02, 1.26258625e-02, &
       1.37961878e-02, 1.48895464e-02, 1.58952068e-02, 1.68079036e-02, &
       1.76264555e-02, 1.83529293e-02, 1.89914581e-02, 1.95473803e-02, &
       2.00265565e-02, 2.04348908e-02, 2.07780104e-02, 2.10610649e-02, &
       2.12886507e-02, 2.14647720e-02, 2.15928902e-02, 2.16759573e-02, &
       2.17164877e-02, 2.17166231e-02, 2.16782099e-02, 2.16028608e-02, &
       2.14920237e-02, 2.13470310e-02, 2.11691519e-02, 2.09596320e-02, &
       2.07197286e-02, 2.04507376e-02, 2.01540148e-02, 1.98309904e-02, &
       1.94831778e-02, 1.91121777e-02, 1.87196766e-02, 1.83074414e-02, &
       1.78773108e-02, 1.74311828e-02, 1.69710008e-02, 1.64987371e-02, &
       1.60163764e-02, 1.55258978e-02, 1.50292575e-02, 1.45283720e-02 /

! D-->Zr, physical. TrimSP calculated.
real :: d_zr_yields(n_values)
data d_zr_yields / &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 2.91436658e-08, &
       5.08355123e-06, 2.28564130e-05, 5.97586863e-05, 1.24374903e-04, &
       2.27520759e-04, 3.82472193e-04, 6.04420053e-04, 9.09341913e-04, &
       1.31182032e-03, 1.82196300e-03, 2.44207708e-03, 3.16356821e-03, &
       3.96609671e-03, 4.81942431e-03, 5.68806554e-03, 6.53717006e-03, &
       7.33770611e-03, 8.06949465e-03, 8.72173189e-03, 9.29160236e-03, &
       9.78204033e-03, 1.01993959e-02, 1.05515983e-02, 1.08468223e-02, &
       1.10927156e-02, 1.12959990e-02, 1.14623475e-02, 1.15964033e-02, &
       1.17018884e-02, 1.17817283e-02, 1.18381957e-02, 1.18730371e-02, &
       1.18875881e-02, 1.18828698e-02, 1.18596712e-02, 1.18186154e-02, &
       1.17602155e-02, 1.16849185e-02, 1.15931415e-02, 1.14852999e-02, &
       1.13618298e-02, 1.12232055e-02, 1.10699512e-02, 1.09026500e-02, &
       1.07219488e-02, 1.05285599e-02, 1.03232603e-02, 1.01068884e-02 /

! D-->B, physical. TrimSP calculated.
real :: d_b_yields(n_values)
data d_b_yields /&
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, &
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 5.65657254e-06, &
       8.07326334e-05, 2.47871817e-04, 5.04917046e-04, 8.64822882e-04, &
       1.34509563e-03, 1.96371093e-03, 2.73848243e-03, 3.68059267e-03, &
       4.79365264e-03, 6.07508731e-03, 7.50849628e-03, 9.06612041e-03, &
       1.07093559e-02, 1.23925214e-02, 1.40669336e-02, 1.56847841e-02, &
       1.72055693e-02, 1.85966381e-02, 1.98364305e-02, 2.09122860e-02, &
       2.18215610e-02, 2.25674215e-02, 2.31579971e-02, 2.36042486e-02, &
       2.39186639e-02, 2.41141502e-02, 2.42030159e-02, 2.41969671e-02, &
       2.41066221e-02, 2.39416030e-02, 2.37104944e-02, 2.34209434e-02, &
       2.30797704e-02, 2.26930853e-02, 2.22663938e-02, 2.18046931e-02, &
       2.13125544e-02, 2.07941944e-02, 2.02535232e-02, 1.96941899e-02, &
       1.91196094e-02, 1.85329895e-02, 1.79373402e-02, 1.73354907e-02, &
       1.67300845e-02, 1.61235933e-02, 1.55183116e-02, 1.49163611e-02, &
       1.43196900e-02, 1.37300749e-02, 1.31491220e-02, 1.25782713e-02, &
       1.20187976e-02, 1.14718178e-02, 1.09382954e-02, 1.04190471e-02, &
       9.91474971e-03, 9.42594875e-03, 8.95306597e-03, 8.49640845e-03, &
       8.05617711e-03, 7.63247579e-03, 7.22531999e-03, 6.83464557e-03 /

public :: yield_tib2_zrb2

contains
      
  real function lin_interp(val, lookup, result_data, ndata, minopt)
  
    ! Linear interpolation at val using the point-slope formula. If val
    ! is greater than the last lookup values, the last result_data is
    ! returned.
    ! 
    ! val (real) : The X value to get interpolated value at.
    ! lookup (real, ndata) : X coordinates of data to be interpolated.
    ! result_data (real, ndata) : Y coordinates
    ! ndata (int) : Number of coordinates
    ! minopt (int) : Option for how to treat values less than the 
    !   minimum in lookup. 0 = return zero. 1 = return the first 
    !   result_data value.
  
    implicit none
    integer ndata
    integer, intent(in) ::  minopt
    real val, lookup(ndata), result_data(ndata)

    integer in,ipos
    external ipos

    if (val.lt.lookup(1)) then 
       if (minopt.eq.1) then 
          lin_interp = 0.0
       elseif (minopt.eq.2) then 
          lin_interp = result_data(1)
       endif
    elseif (val.eq.lookup(1)) then 
       lin_interp = result_data(1)
    elseif (val.ge.lookup(ndata)) then 
       lin_interp = result_data(ndata)
    else
       in = ipos(val,lookup,ndata)
       lin_interp = &
            (val-lookup(in-1))/(lookup(in)-lookup(in-1))* &
            (result_data(in)-result_data(in-1)) + &
             result_data(in-1)
    endif

    return
  end function lin_interp
  
  real function yield_tib2_zrb2(energy, usage)
  
    ! Estimate the sputtering yield of either TiB2 or ZrB2 using the
    ! stochiometric combinations of the above TrimSP, pure-element
    ! calculated yields. 
    ! For TiB2:  Y_B_TiB2  = (2/3) * Y_B
    !            Y_Ti_TiB2 = (1/3) * Y_Ti
    ! For ZrB2:  Y_B_ZrB2  = (2/3) * Y_B
    !            Y_Zr_ZrB2 = (1/3) * Y_Zr
    !
    ! Usage switch: 0 = TiB2, B
    !               1 = TiB2, Ti
    !               2 = ZrB2, B
    !               3 = ZrB2, Zr
    !
    ! Note: 0 and 2 do the same thing, but the human brain probably
    ! likes to see them split up so I leave them as such.
    
  
    implicit none
    real :: energy
    integer :: usage
    
    yield_tib2_zrb2 = 0.0
  
    ! B from either TiB2 or ZrB2.
    if (usage.eq.0.or.usage.eq.2) then
      yield_tib2_zrb2 = (2.0 / 3.0) * &
        lin_interp(energy, d_impact_e, d_b_yields, n_values, 0)
        
    ! Ti from TiB2.
    elseif (usage.eq.1) then
      yield_tib2_zrb2 = (1.0 / 3.0) * &
        lin_interp(energy, d_impact_e, d_ti_yields, n_values, 0)
        
    ! Zr from ZrB2.
    elseif (usage.eq.3) then
      yield_tib2_zrb2 = (1.0 / 3.0) * &
        lin_interp(energy, d_impact_e, d_zr_yields, n_values, 0)
        
    else
      write(0,*) 'Invalid usage switch value in yield_tib2_zrb2! usage =', usage
      write(0,*) 'Stopping'
      write(6,*) 'Invalid usage switch value in yield_tib2_zrb2! usage =', usage
      write(6,*) 'Stopping'
      stop
    endif
  
    return
  
  end function yield_tib2_zrb2

end module tib2_zrb2_yields
