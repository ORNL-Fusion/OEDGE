CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     NAME: INITIAL_NEUTRAL                                          C
C Function: set up all data necessary for running Eirene             C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      SUBROUTINE INITIAL_NEUTRAL()
      USE PARALLEL 
      USE PHYSICAL_CELL
      USE NEUTRAL_TRANSPORT

      IMPLICIT NONE 
      INTEGER,PARAMETER :: UNIT=4
      INTRINSIC SUM
C----------------------------------------------------------------------  
C 1. Geometry, mesh, grid
C NONTRT_N0 
C IZONR_N0 IR0NR_N0 IP1NR_N0 IP2NR_N0 IT1NR_N0 IT2NR_N0 INDINR_N0
C NONTPT_N0 
C IZONP_N0 IR0NP_N0 IP1NP_N0 IP2NP_N0 IT1NP_N0 IT2NP_N0 INDINP_N0
C NONTPT_N0 
C IZONT_N0 IR0NT_N0 IP1NT_N0 IP2NT_N0 IT1NT_N0 IT2NT_N0 INDINT_N0
      IF(MYPE == 0) CALL READ_SF_N0(UNIT)  
      IF (NPRS > 1) CALL BROADCAST_SF_N0() 
C IDSURR IDSURP IDSURT updated in OPEN_NEUTRAL
C     CALL UPDATA_SF_N0()

C 2. Cell for neutral
C NCELL_N1 NCELL_N2 NCTYPE_DEF NCELL_AB
C IDCELL 
C PLASMA_ADD_CELL
      IF(MYPE == 0) CALL READ_CELL_NR_N0(UNIT)
      IF (NPRS > 1) CALL BROADCAST_CELL_NR_N0() 
C VOLCEL_N0
      CALL UPDATA_CELL_NR_N0()
      IF(MYPE == 0)
     .WRITE(6,*)'  Total volume(+add. cells):'
     .,VOLCEL(0)+SUM(VOLCEL_N0),' cm**3 cm'

C3. Neutral Source distribution
C NSSTOR N0S_DEF NS_PLACE NSSIDE
C NADDSF IJK_N0 IZO_N0 ISD_N0 IR0_N0 IP0_N0 IT0_N0
C GEWICH XSOURP YSOURP ZSOURP
      IF(MYPE == 0) CALL READ_SOURCE_N0(UNIT)
      IF (NPRS > 1) CALL BROADCAST_SOURCE_N0()
      CALL UPDATA_SOURCE_N0()

C4. additional surfaces
C NPLATE   NTRIANG
C ISR_TYPE NSTUCK
C X_TRIA   Y_TRIA   Z_TRIA
      IF(MYPE == 0) CALL READ_ADD_SF_N0(UNIT)
      IF (NPRS > 1) CALL BROADCAST_ADD_SF_N0()
C NPSORT NP_NUM NP_GRP NPS_GRP NPN_GRP
C A_PLAT A_TRIA V_TRIA_X V_TRIA_Y V_TRIA_Z X_SORT Y_SORT Z_SORT
C D_MAXI D_MINI X_SMIN X_SMAX Y_SMIN Y_SMAX Z_SMIN Z_SMAX
C V_SORT_X V_SORT_Y V_SORT_Z
      CALL UPDATA_ADD_SF_N0()
      IF(MYPE == 0) THEN
        WRITE(6,*)' Groups:',NPSORT
        WRITE(6,*)' Elements:'
        WRITE(6,'(18I4)') NP_GRP(1:NPSORT)
      ENDIF 

      RETURN
      END 
