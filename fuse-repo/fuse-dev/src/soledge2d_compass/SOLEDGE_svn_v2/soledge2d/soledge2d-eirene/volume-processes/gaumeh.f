C
C
      SUBROUTINE EIRENE_GAUMEH(RS,ER,B,IFLAG,P,N,IGAUS,RESULT)
C
C  IGAUS=1
C  GAUSS MEHLER QUADRATURE, N=5,10,20, W(X)=1./SQRT(1+X)/SQRT(1-X)
C                           INTEGRATION FROM A=-1 TO B=1
C                           TRANSFORMED TO A=0,B=1, AND
C                           W(X)=1./SQRT(X)/SQRT(1-X)
C
 
      USE EIRMOD_PRECISION
      USE EIRMOD_COMPRT, ONLY: IUNOUT
 
      IMPLICIT NONE
      REAL(DP), INTENT(IN) :: RS, ER, B, P(*)
      REAL(DP), INTENT(OUT) :: RESULT
      INTEGER, INTENT(IN) :: IFLAG, N, IGAUS
 
      REAL(DP) :: AR(128), AFI(128)
      INTEGER :: NFI
      COMMON /CFI/ AR,AFI,NFI
      REAL(DP) :: X5A(5),X5B(5),X10A(10),X10B(10),X20A(20),X20B(20)
      REAL(DP) :: X5(5),X10(10),X20(20)
C
      REAL(DP) :: XG10(10),WG10(10),XG10A(10),XG10B(10)
      REAL(DP) :: SUM, F, X, W5, W10, W20
      INTEGER :: I, IFIRST, IFI
C
      SAVE
      DATA X5 /0.95105654E+00,0.58778542E+00,0.31391647E-06,
     .       - 0.58778363E+00,-0.95105600E+00/,
     .W5 /0.62831837E+00/
      DATA X10/9.876884E-01, 8.910065E-01,7.071068E-01,4.539905E-01,
     .         1.564344E-01,-1.564345E-01,-4.539905E-01,-7.071068E-01,
     .        -8.910065E-01,-9.876884E-01/,
     .W10/3.141593E-01/
      DATA X20/9.969173E-01,9.723699E-01,9.238795E-01,8.526402E-01,
     .         7.604060E-01,6.494480E-01,5.224985E-01,3.826834E-01,
     .         2.334453E-01,
     .         7.845905E-02,-7.845914E-02,-2.334454E-01,-3.826835E-01,
     .        -5.224986E-01,-6.494481E-01,-7.604060E-01,-8.526402E-01,
     .        -9.238796E-01,-9.723700E-01,-9.969174E-01/,
     .W20/1.570796E-01/
C
C  IGAUS=2
C  GAUSS MEHLER QUADRATURE, N=10, W(X)=1./SQRT(1-X)
C                           INTEGRATION FROM A=0 TO B=1
      DATA XG10/
     .    .013695585480651072296,
     .    .070758123420104485088,
     .    .16782834791297652828,
     .    .29588270759990962383,
     .    .44298868539955669668,
     .    .59543571523425259033,
     .    .73901490631777356542,
     .    .86034375925702257262,
     .    .94811360601967719799,
     .    .99414369156320387287/
      DATA WG10/
     .    .035228014278304236584,
     .    .081202859600773882686,
     .    .12534409666821812627,
     .    .16655348315340949082,
     .    .20386023963448093937,
     .    .23638906392303662412,
     .    .26337727689835336360,
     .    .28419221863676482994,
     .    .29834597294520589473,
     .    .30550677426145261144/
      DATA IFIRST /0/
      IF (IFIRST.EQ.0) THEN
C SET ROOTS AND WEIGHTS FOR GAUSS QUADRATURE RULES
        IFIRST=1
        DO 5 I=1,5
          X=0.5*(1.+X5(I))
          X5A(I)=SQRT(X*(1.-X))
          X5B(I)=1./X
5       CONTINUE
        DO 10 I=1,10
          X=0.5*(1.+X10(I))
          X10A(I)=SQRT(X*(1.-X))
          X10B(I)=1./X
10      CONTINUE
        DO 11 I=1,10
          X=XG10(I)
          XG10A(I)=SQRT(1.-X)
          XG10B(I)=1./X
11      CONTINUE
        DO 20 I=1,20
          X=0.5*(1.+X20(I))
          X20A(I)=SQRT(X*(1.-X))
          X20B(I)=1./X
20      CONTINUE
      ENDIF
C
      NFI=N
      IF (N.EQ.5) THEN
        DO 50 IFI=1,5
          AR(IFI)=RS*X5B(IFI)
50      CONTINUE
C
        CALL EIRENE_FIVEC(ER,B,IFLAG,P)
        SUM=0.D0
        DO 51 IFI=1,5
          F=AFI(IFI)
          IF (F.GT.0.D0)
     .    SUM=SUM+X5A(IFI)/SQRT(F)
51      CONTINUE
        RESULT=W5*SUM
C
      ELSEIF (N.EQ.10) THEN
        IF (IGAUS.EQ.1) THEN
          DO 100 IFI=1,10
            AR(IFI)=RS*X10B(IFI)
100       CONTINUE
C
          CALL EIRENE_FIVEC(ER,B,IFLAG,P)
          SUM=0.D0
          DO 101 IFI=1,10
            F=AFI(IFI)
            IF (F.GT.0.D0)
     .      SUM=SUM+X10A(IFI)/SQRT(F)
101       CONTINUE
          RESULT=W10*SUM
        ELSEIF (IGAUS.EQ.2) THEN
          DO 110 IFI=1,10
            AR(IFI)=RS*XG10B(IFI)
110       CONTINUE
C
          CALL EIRENE_FIVEC(ER,B,IFLAG,P)
          SUM=0.D0
          DO 111 IFI=1,10
            F=AFI(IFI)
            IF (F.GT.0.D0)
     .      SUM=SUM+XG10A(IFI)/SQRT(F)*WG10(IFI)
111       CONTINUE
          RESULT=SUM
        ENDIF
C
      ELSEIF (N.EQ.20) THEN
        DO 200 IFI=1,20
          AR(IFI)=RS*X20B(IFI)
200     CONTINUE
C
        CALL EIRENE_FIVEC(ER,B,IFLAG,P)
        SUM=0.D0
        DO 201 IFI=1,20
          F=AFI(IFI)
          IF (F.GT.0.D0)
     .    SUM=SUM+X20A(IFI)/SQRT(F)
201     CONTINUE
        RESULT=W20*SUM
C
      ELSE
        WRITE (iunout,*) 'ERROR IN GAUMEH, WRONG PARAMETER N'
        CALL EIRENE_EXIT_OWN(1)
      ENDIF
      RETURN
      END
